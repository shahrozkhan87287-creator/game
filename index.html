<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hen Hop ‚Äî Jump-Over Headshots (by Shahroz)</title>
<style>
  :root { --ink:#0c0f17; --text:#eaf2ff; --chip:#0e203e; --chip2:#0a152b; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--ink);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:760px;margin:0 auto;padding:14px}
  .bar{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .chip{background:linear-gradient(180deg,var(--chip),var(--chip2));border:1px solid #1b335c;border-radius:999px;padding:6px 12px;font-weight:700;box-shadow:0 6px 16px rgba(0,0,0,.25)}
  .grow{flex:1}
  #game{display:block;width:100%;height:auto;border-radius:16px;border:1px solid #1a2742;box-shadow:0 18px 50px rgba(0,0,0,.55);background:#88cfff}
  .note{opacity:.9;text-align:center;font-size:12px;margin-top:8px}
  .btn{appearance:none;border:none;background:#2ecc71;color:#07121f;padding:6px 12px;border-radius:10px;font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.3)}
  .troll{min-height:18px;opacity:.95}
</style>
</head>
<body>
<div class="wrap">
  <div class="bar">
    <div class="chip">Score: <span id="s">0</span></div>
    <div class="chip">Best: <span id="best">0</span></div>
    <div class="chip">Level: <span id="lvl">1</span></div>
    <div class="chip">Lives: <span id="lives">3</span> ‚ù§Ô∏è</div>
    <div class="troll grow" id="troll"></div>
    <button class="btn" id="pauseBtn" title="P to pause/resume">Pause</button>
    <div class="chip">by <b>Shahroz Khan</b></div>
  </div>
  <canvas id="game" width="720" height="405" aria-label="Hen Hop"></canvas>
  <div class="note">Jump over a person to auto drop a ü§ç poop on their head ‚Ä¢ Tap/Space/‚Üë to jump ‚Ä¢ P to pause</div>
</div>

<script>
(function(){
  const cv = document.getElementById('game');
  const ctx = cv.getContext('2d');
  const W=cv.width, H=cv.height, GY=H-58;
  const GRAV=0.60, JUMP=-11.2, FALLMAX=14;

  // UI
  const scoreEl=document.getElementById('s');
  const bestEl=document.getElementById('best');
  const lvlEl=document.getElementById('lvl');
  const livesEl=document.getElementById('lives');
  const pauseBtn=document.getElementById('pauseBtn');
  const trollEl=document.getElementById('troll');

  // Audio (all synthesized)
  let AC=null, audioPrimed=false;
  const ac=()=>{ if(!AC){ const C=window.AudioContext||window.webkitAudioContext; AC=new C(); } return AC; };
  function tone(f=640,d=0.08,v=0.25,type='sine',endF=null){
    const a=ac(); if(a.state==='suspended') a.resume();
    const o=a.createOscillator(), g=a.createGain(); const t=a.currentTime;
    o.type=type; o.frequency.setValueAtTime(f,t); if(endF){ o.frequency.exponentialRampToValueAtTime(endF,t+d*0.9); }
    g.gain.setValueAtTime(v,t); g.gain.exponentialRampToValueAtTime(0.0001,t+d);
    o.connect(g).connect(a.destination); o.start(t); o.stop(t+d);
  }
  const sCluck=()=>{ tone(620,0.06,0.22,'square', 480); setTimeout(()=>tone(760,0.05,0.18,'square', 520), 35); };
  const sBwak =()=> tone(260,0.18,0.35,'sawtooth', 180);
  const sSplat=()=> tone(900,0.10,0.22,'triangle', 300);
  const sTing =()=> tone(1400,0.13,0.22,'square', 2200);

  // Player (hen)
  let px=120, py=GY-26, pw=26, ph=26, pvy=0, on=true, hold=false, buf=0, coyote=0;
  let runPhase=0, squash=1, stretch=1, landCooldown=0;
  let popPulse=0, popRing=0, wingFlap=0, beakBlink=0, googly=0;
  let invuln=0, recentJump=0; // recentJump gates the poop

  // Backdrop
  const clouds=[], birds=[];
  for(let i=0;i<7;i++) clouds.push({x:Math.random()*W, y:Math.random()*120+20, s:0.5+Math.random()*1.2});
  function spawnBird(){ birds.push({x: W + Math.random()*120, y: 48 + Math.random()*115, v: 1.1 + Math.random()*0.9, flap: Math.random()*Math.PI*2, dir: Math.random()<.6 ? -1 : 1}); }
  for(let i=0;i<2;i++) spawnBird();

  // Effects & entities
  const parts=[]; // dust/feathers/splat/confetti
  const pops=[];  // ‚ÄúHEADSHOT!‚Äù text pops
  // Entities: pipe/guy/coin/poop/egg (egg optional bonus kept)
  const obs=[];
  let baseSpeed=4, spawnCD=60, spawnTimer=0;

  // Game state
  let score=0, best=+(localStorage.getItem('henhop_best')||0); bestEl.textContent=best;
  let level=1, frames=0, levelAnim=0, paused=false, countdown=30, running=true, shake=0;
  let snake=null, lives=3; livesEl.textContent=lives;

  // Input
  let want=false;
  function press(){ if(!audioPrimed){ try{ac(); audioPrimed=true;}catch{} } if(!running && countdown===0){ restart(); return; } want=true; hold=true; }
  function release(){ hold=false; }
  cv.addEventListener('pointerdown', press, {passive:true});
  addEventListener('pointerup', release, {passive:true});
  addEventListener('keydown', e=>{
    if(e.repeat) return;
    if(e.code==='Space'||e.code==='ArrowUp'){ press(); if(!running && countdown===0){ restart(); return; } }
    if(e.code==='KeyP') togglePause();
    if((e.code==='Enter'||e.code==='NumpadEnter') && !running && countdown===0) restart();
  });
  addEventListener('keyup', e=>{ if(e.code==='Space'||e.code==='ArrowUp') release(); });
  function togglePause(){ if(!running) return; paused=!paused; pauseBtn.textContent = paused?'Resume':'Pause'; }
  pauseBtn.onclick = togglePause;

  // Helpers
  const rand=(a,b)=>Math.random()*(b-a)+a, irand=(a,b)=>Math.floor(rand(a,b));
  const hit=(ax,ay,aw,ah,bx,by,bw,bh)=> ax<bx+bw && ax+aw>bx && ay<by+bh && ay+ah>by;
  function dust(x0,y0,dir=1,col='#ffffff'){ for(let i=0;i<6;i++) parts.push({x:x0,y:y0,vx:(Math.random()*1.5+0.5)*dir,vy:-Math.random()*1.5-0.2,a:1,sz:2,col});}
  function feathers(x0,y0){ for(let i=0;i<6;i++) parts.push({x:x0+rand(-3,3),y:y0+rand(-3,3),vx:rand(-1,1),vy:rand(-2,-0.5),a:1,sz:2,col:'#fff'}); }
  function splat(x0,y0){ for(let i=0;i<10;i++) parts.push({x:x0+rand(-3,3),y:y0+rand(-1,2),vx:rand(-0.6,0.6),vy:rand(-0.4,0.2),a:1,sz:2,col:'#f5f5f5'}); }

  function taunt(msg){ trollEl.textContent = msg || ["peck-peck üòè","speeding up‚Ä¶","nice stomp!","free cardio!"][irand(0,4)]; }

  // Spawners
  function spawnPipePair(xStart){
    const w=irand(24, 36 + Math.min(10, level));
    const h=irand(18 + Math.min(22, level*2), 40 + Math.min(32, level*2));
    obs.push({type:'pipe',x:xStart,y:GY-h,w,h,bob:Math.random()<0.18});
  }
  function spawnGuys(xStart){
    const w=irand(18,22), h=irand(26,32), color=Math.random()<.5?'#ff9f43':'#54a0ff';
    obs.push({type:'guy',x:xStart,y:GY-h,w,h,walk:0,color,pooped:false});
    if(Math.random()<.4){ const d=irand(40,80); obs.push({type:'guy',x:xStart+d,y:GY-h,w:irand(18,22),h:irand(26,32),walk:0,color:(Math.random()<.5?'#10ac84':'#ee5253'),pooped:false}); }
  }
  function spawnCoin(x,y,shy=false){ obs.push({type:'coin',x,y,w:14,h:14,shy,jig:Math.random()*Math.PI*2,sparkle:0}); }
  function spawnChunk(xStart){
    if(Math.random()<0.45){ spawnGuys(xStart); if(Math.random()<0.6) spawnCoin(xStart+irand(12,28), GY - irand(60,100), true); }
    else { spawnPipePair(xStart); if(Math.random()<0.75) spawnCoin(xStart+10, GY - irand(90,130), Math.random()<0.5); }
  }

  // Restart
  function restart(){
    px=120; py=GY-26; pw=26; ph=26; pvy=0; on=true; hold=false; buf=0; coyote=0;
    runPhase=0; squash=1; stretch=1; landCooldown=0; popPulse=0; popRing=0; wingFlap=0; beakBlink=0; googly=0; invuln=0; recentJump=0;
    obs.length=0; parts.length=0; pops.length=0;
    baseSpeed=4; spawnCD=60; spawnTimer=30;
    score=0; scoreEl.textContent=score; level=1; lvlEl.textContent=level; frames=0; levelAnim=24;
    snake=null; shake=0; paused=false; pauseBtn.textContent='Pause'; trollEl.textContent="";
    lives=3; livesEl.textContent=lives; running=true; countdown=30;
  }

  // Drop aimed white poop helper (ballistic to a target head)
  function dropPoopAimed(targetX, targetY){
    const startX = px+pw/2, startY = py+ph/2;
    const vy0 = 1.0, g = 0.28;
    const A=0.5*g, B=vy0, C=startY-targetY;
    let t = (-B + Math.sqrt(Math.max(0,B*B - 4*A*C)))/(2*A);
    if(!isFinite(t) || t<0.12) t=0.12; if(t>1.2) t=1.2;
    const guyFutureX = targetX - baseSpeed*0.95*t;
    const vx0 = (guyFutureX - startX)/t;
    obs.push({type:'poop', x:startX, y:startY, vx:vx0, vy:vy0, rot:0, land:false});
  }

  // Loop
  function step(){
    if(countdown>0){ draw(); countdown--; return requestAnimationFrame(step); }
    if(!running){ draw(); return requestAnimationFrame(step); }
    if(paused){ draw(); return requestAnimationFrame(step); }

    frames++; if(invuln>0) invuln--; if(recentJump>0) recentJump--;

    // Difficulty
    if(frames % 480 === 0){
      level++; lvlEl.textContent=level; levelAnim=24;
      baseSpeed=Math.min(9.6, baseSpeed+0.45);
      spawnCD=Math.max(26, spawnCD-5);
      taunt();
    }

    // Spawn cadence
    if(--spawnTimer<=0){ spawnChunk(W+10); spawnTimer = spawnCD + irand(-10,14); }

    // Handle jump buffer / coyote & sounds
    if(want){ buf=7; want=false; }
    if(on) coyote=5; else if(coyote>0) coyote--;
    if(buf>0){
      if(on||coyote>0){
        pvy=JUMP; on=false; buf=0; recentJump=18; // ~0.3s window after jumping
        sCluck();
        squash=0.86; stretch=1.22; popPulse=1; popRing=1; wingFlap=1; googly=1;
        dust(px+pw/2, GY, (Math.random()<0.5?-1:1),'#fff'); feathers(px+pw/2, py+ph/2);
      } else { buf--; }
    }

    // Physics
    if(hold && pvy<0) pvy+=-0.25;
    pvy+=GRAV; if(pvy>FALLMAX) pvy=FALLMAX;
    const wasOn=on; py+=pvy; if(py+ph>=GY){ py=GY-ph; pvy=0; on=true; } else on=false;
    if(!wasOn && on){ landCooldown=6; squash=1.12; stretch=0.9; beakBlink=1; dust(px+pw/2, GY, (Math.random()<0.5?-1:1)); }
    squash += (1 - squash)*0.18; stretch += (1 - stretch)*0.18;
    if(landCooldown>0) landCooldown--;
    runPhase += on ? (0.28 + baseSpeed*0.02) : 0.16;
    popPulse *= 0.86; popRing *= 0.90; wingFlap *= 0.9; beakBlink *= 0.9; googly *= 0.95;

    // Move/logic entities + jump-over-only poop trigger
    for(const o of obs){
      if(o.type==='pipe'){
        o.x -= baseSpeed;
      }else if(o.type==='guy'){
        o.x -= baseSpeed*0.95; o.walk += 0.25 + baseSpeed*0.02;
        if(o.squished){ o.deadT=(o.deadT||0)+1; }
        // Only if we JUST jumped, we‚Äôre airborne, and the guy is under us ‚Üí drop aimed poop once
        const henCX = px+pw/2, guyCX = o.x+o.w/2, headY = o.y+4;
        const horizontallyClose = Math.abs(henCX - guyCX) < 48;
        const aboveHead = (py+ph) < headY-2;
        if(recentJump>0 && !on && !o.pooped && horizontallyClose && aboveHead){
          o.pooped = true;
          dropPoopAimed(guyCX, headY);
        }
      }else if(o.type==='coin'){
        o.x -= baseSpeed*0.92; o.jig = (o.jig||0)+0.2; o.y += Math.sin(o.jig)*0.6;
      }else if(o.type==='poop'){
        o.vy += 0.28; o.x += o.vx; o.y += o.vy; o.rot += 0.2;
      }
    }

    // Collisions
    for(let i=obs.length-1;i>=0;i--){
      const o=obs[i];
      if(o.type==='coin'){
        if(hit(px,py,pw,ph,o.x,o.y,o.w,o.h)){ addScore(2); sTing(); obs.splice(i,1); }
        continue;
      }
      if(o.type==='poop'){
        // check headshots
        if(!o.land){
          for(const g of obs){
            if(g.type==='guy' && !g.squished){
              const gx=g.x+g.w/2, gy=g.y+4;
              if(Math.abs(o.x-gx)<6 && Math.abs(o.y-gy)<6){
                g.squished=true; g.deadT=0; splat(gx, gy); sSplat();
                pops.push({x:gx, y:gy-16, a:1, vy:-0.6, scale:1});
                o.land=true;
              }
            }
          }
          if(o.y >= GY-6){ o.land=true; o.y = GY-6; o.vx=0; o.vy=0; splat(o.x,o.y+4); sSplat(); }
        }
        continue;
      }
      if(o.type==='guy' && !o.squished){
        if(hit(px,py,pw,ph,o.x,o.y,o.w,o.h)){
          const overlapY=(py+ph)-o.y;
          if(pvy>0 && overlapY<12){
            o.squished=true; feathers(o.x+o.w/2, o.y+2); sSplat();
            pvy=-8.2; squash=0.86; stretch=1.18; popPulse=1; popRing=1;
          }else if(invuln<=0){
            takeHit();
          }
        }
      }else if(o.type==='pipe'){
        if(hit(px,py,pw,ph,o.x,o.y,o.w,o.h) && invuln<=0) takeHit();
      }
    }

    // Cleanup & score for passed obstacles / dead guys
    for(let i=obs.length-1;i>=0;i--){
      const o=obs[i];
      if(o.type!=='poop' && o.x+ (o.w||0) < 0){
        if(o.type!=='coin' && o.type!=='egg' && !o.squished) addScore(1);
        obs.splice(i,1);
      }
      if(o.type==='guy' && o.squished && o.deadT>30){ addScore(1); obs.splice(i,1); }
      if(o.type==='poop' && (o.x<-20 || o.x>W+20 || (o.land && Math.random()<0.02))) obs.splice(i,1);
    }

    // particles + headshot pop text
    for(let i=parts.length-1;i>=0;i--){ const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.12; p.a-=0.03; if(p.a<=0) parts.splice(i,1); }
    for(let i=pops.length-1;i>=0;i--){ const h=pops[i]; h.y+=h.vy; h.vy*=0.98; h.a-=0.02; h.scale+=0.01; if(h.a<=0) pops.splice(i,1); }

    draw();
    requestAnimationFrame(step);
  }

  function addScore(n){ score+=n; scoreEl.textContent=score; if(score>best){ best=score; localStorage.setItem('henhop_best', best); bestEl.textContent=best; } }
  function takeHit(){
    lives--; livesEl.textContent=lives; sBwak(); invuln=90;
    dust(px+pw/2, py+ph/2, (Math.random()<0.5?-1:1));
    if(lives<=0){ running=false; }
  }

  // Draw
  function draw(){
    // background
    ctx.setTransform(1,0,0,1,0,0);
    const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#69c3ff'); g.addColorStop(1,'#a8e0ff'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='rgba(255,255,255,.93)'; for(const c0 of clouds){ bubble(c0.x,c0.y,26*c0.s); bubble(c0.x+22*c0.s,c0.y+7*c0.s,18*c0.s); bubble(c0.x-18*c0.s,c0.y+9*c0.s,16*c0.s); }
    for(const b of birds){ drawBird(b); }
    ctx.fillStyle='#5daa2a'; ctx.fillRect(0,GY,W,H-GY); const stripeOffset=(frames*baseSpeed*0.6)%32; ctx.fillStyle='#3a7d24'; for(let xg=-stripeOffset;xg<W;xg+=32) ctx.fillRect(xg,GY+24,22,6);

    // entities
    for(const o of obs){
      if(o.type==='pipe'){ drawPipe(o); }
      else if(o.type==='guy'){ drawGuy(o); }
      else if(o.type==='coin'){ drawCoin(o); }
      else if(o.type==='poop'){ drawPoop(o); }
    }

    // particles
    for(const p of parts){ ctx.globalAlpha=Math.max(0,p.a); ctx.fillStyle=p.col; ctx.fillRect(p.x,p.y,p.sz,p.sz); ctx.globalAlpha=1; }

    // hen
    drawHen();

    // headshot text
    for(const h of pops){
      ctx.save(); ctx.translate(h.x, h.y); ctx.scale(h.scale, h.scale);
      ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.lineWidth=4; ctx.globalAlpha=Math.max(0,h.a);
      ctx.font='bold 22px system-ui,sans-serif'; ctx.strokeStyle='rgba(0,0,0,.75)'; ctx.strokeText('HEADSHOT!', 0, 0);
      ctx.fillStyle='#fff64d'; ctx.fillText('HEADSHOT!', 0, 0);
      ctx.restore();
    }

    if(countdown>0){
      ctx.fillStyle='rgba(0,0,0,.35)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font='bold 48px system-ui,sans-serif';
      const n=Math.ceil(countdown/30); ctx.fillText(n, W/2, H/2);
    }
  }

  // Draw helpers
  function drawPipe(o){
    ctx.fillStyle='#2ecc71'; ctx.fillRect(o.x,o.y,o.w,o.h);
    ctx.fillStyle='#27ae60'; ctx.fillRect(o.x-4,o.y-6,o.w+8,6);
    ctx.strokeStyle='rgba(0,0,0,.15)'; ctx.strokeRect(o.x,o.y,o.w,o.h);
  }
  function drawGuy(o){
    ctx.fillStyle='rgba(0,0,0,.15)'; ctx.beginPath(); ctx.ellipse(o.x+o.w/2, o.y+o.h+6, 12, 5, 0, 0, Math.PI*2); ctx.fill();
    if(o.squished){ ctx.fillStyle=o.color+'cc'; ctx.fillRect(o.x+2, o.y+o.h-6, o.w-4, 6); ctx.fillStyle='#ffd9b3cc'; ctx.fillRect(o.x+o.w/2-5, o.y+o.h-10, 10, 4); return; }
    const k=Math.sin(o.walk||0)*3; ctx.fillStyle=o.color;
    ctx.fillRect(o.x+2+k, o.y+o.h-8, 5, 8); ctx.fillRect(o.x+o.w-7-k, o.y+o.h-8, 5, 8);
    ctx.fillRect(o.x+2, o.y+8, o.w-4, o.h-12);
    ctx.fillStyle='#ffd9b3'; ctx.beginPath(); ctx.arc(o.x+o.w/2, o.y+6, 6, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#000'; ctx.fillRect(o.x+o.w/2-3, o.y+5, 2, 2); ctx.fillRect(o.x+o.w/2+1, o.y+5, 2, 2);
  }
  function drawCoin(o){
    ctx.globalAlpha = 0.25 + 0.25*Math.sin((o.jig||0)*10);
    ctx.fillStyle='#ffef9a'; ctx.beginPath(); ctx.arc(o.x+o.w/2, o.y+o.h/2, o.w*0.95, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha = 1;
    ctx.fillStyle='#ffd166'; ctx.beginPath(); ctx.arc(o.x+o.w/2, o.y+o.h/2, o.w/2, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle='#ffef9a'; ctx.stroke();
    ctx.fillStyle='#fff'; const t=(o.jig||0); const gx=o.x+o.w/2+Math.cos(t*8)*3, gy=o.y+o.h/2+Math.sin(t*8)*3; ctx.fillRect(gx,gy,2,2);
  }
  function drawPoop(o){
    ctx.save(); ctx.translate(o.x,o.y); ctx.rotate(o.rot||0);
    ctx.fillStyle='#f5f5f5';
    ctx.beginPath(); ctx.arc(0,-3,3,0,Math.PI*2); ctx.arc(0,0,5,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }
  function drawHen(){
    const bx=px, by=py, bw=pw, bh=ph, cx=bx+bw/2, cy=by+bh/2;
    const blinkAlpha = (invuln>0 && Math.floor(invuln/4)%2===0) ? 0.35 : 1;
    ctx.save(); ctx.globalAlpha=blinkAlpha;
    ctx.translate(cx,cy); ctx.scale(stretch + popPulse*0.08, squash - popPulse*0.08); ctx.translate(-cx,-cy);

    // shadow
    ctx.fillStyle='rgba(0,0,0,.15)'; ctx.beginPath(); ctx.ellipse(bx+bw/2, by+bh+7, 16, 6, 0, 0, Math.PI*2); ctx.fill();

    // legs
    const k = Math.sin(runPhase)*3; ctx.fillStyle='#f5a623';
    ctx.fillRect(bx+3+k, by+bh-9, 4, 9); ctx.fillRect(bx+bw-7-k, by+bh-9, 4, 9);

    // body
    ctx.fillStyle='#ffffff'; ctx.beginPath(); ctx.ellipse(bx+bw/2, by+bh/2, bw*0.62, bh*0.56, 0, 0, Math.PI*2); ctx.fill();

    // wing
    const wf = 1 + wingFlap*0.8;
    ctx.fillStyle='#ececec'; ctx.beginPath(); ctx.ellipse(bx+bw/2-4, by+bh/2, 7, 5*wf, -0.35, 0, Math.PI*2); ctx.fill();

    // head + comb
    ctx.fillStyle='#ffffff'; ctx.beginPath(); ctx.ellipse(bx+bw/2+7, by+6, 7, 7, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#e74c3c'; ctx.beginPath(); ctx.arc(bx+bw/2+7, by-1, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(bx+bw/2+11, by+1, 2.4, 0, Math.PI*2); ctx.fill();

    // beak + tiny tongue on jump
    ctx.fillStyle='#f1c40f'; ctx.beginPath(); ctx.moveTo(bx+bw/2+14, by+6); ctx.lineTo(bx+bw/2+9, by+8); ctx.lineTo(bx+bw/2+14, by+10); ctx.closePath(); ctx.fill();

    // googly eyes
    const wob = googly*2; ctx.fillStyle='#fff';
    ctx.beginPath(); ctx.arc(bx+bw/2+5, by+5, 3.2, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(bx+bw/2+9, by+5.2, 3.2, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#000';
    ctx.beginPath(); ctx.arc(bx+bw/2+5 + Math.sin(frames*0.4)*wob, by+5 + Math.cos(frames*0.5)*wob, 1.6, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(bx+bw/2+9 + Math.cos(frames*0.35)*wob, by+5.2 + Math.sin(frames*0.45)*wob, 1.6, 0, Math.PI*2); ctx.fill();

    ctx.restore();

    if(popRing>0.05){
      const r = 10 + (1-popRing)*22;
      ctx.globalAlpha = popRing*0.4; ctx.strokeStyle = '#ffffff';
      ctx.beginPath(); ctx.arc(px+pw/2, py+ph/2, r, 0, Math.PI*2); ctx.stroke(); ctx.globalAlpha = 1;
    }
  }
  function bubble(x0,y0,r){ ctx.beginPath(); ctx.arc(x0,y0,r,0,Math.PI*2); ctx.fill(); }
  function drawBird(b){
    ctx.save(); ctx.translate(b.x,b.y);
    const wing=Math.sin((b.flap=(b.flap||0)+0.2)*6)*1;
    ctx.fillStyle='#f5f6fa'; ctx.beginPath(); ctx.ellipse(0,0,10,6,0,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#dcdde1'; ctx.beginPath(); ctx.ellipse(-6,-2,6,3+wing*0.1,-0.2,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(6,-2,6,3-wing*0.1,0.2,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#f9ca24'; ctx.fillRect(8,0,4,2); ctx.fillStyle='#000'; ctx.fillRect(3,-1,2,2);
    ctx.restore();
  }

  // Go!
  restart(); requestAnimationFrame(step);
})();
</script>
</body>
</html>
